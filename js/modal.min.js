const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxrjQsyOlaXTuSr2AYuyAEVeTPM0ptZyu3kr8XcRrgoD_OPrTkTwy0hXVyHvLHgDbw/exec", MODAL_HTML = `\n<div id="modal-overlay" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 opacity-0 transition-opacity duration-300">\n    <div id="modal-content" class="bg-white w-full max-w-md rounded-[2.5rem] p-8 shadow-2xl relative transform transition-all duration-300 scale-95 overflow-y-auto max-h-[90vh]">\n        <button onclick="closeModal()" aria-label="Закрыть модальное окно" class="absolute top-6 right-6 p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-900 hover:bg-slate-200 transition">\n            <i data-lucide="x" class="w-5 h-5"></i>\n        </button>\n        <div id="modal-success" class="hidden text-center py-10">\n            <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 text-green-600 rounded-full mb-6">\n                <i data-lucide="check" class="w-10 h-10"></i>\n            </div>\n            <h3 class="text-2xl font-black text-slate-900 mb-4">ЗАЯВКА ПРИНЯТА!</h3>\n            <p class="text-slate-500 mb-8">Спасибо. Мы свяжемся с вами в ближайшее время в Telegram или по телефону.</p>\n            <button onclick="closeModal()" class="bg-slate-100 text-slate-900 px-8 py-4 rounded-xl font-bold hover:bg-slate-200 transition">Отлично</button>\n        </div>\n        <div id="modal-form-container">\n            <div class="text-center mb-6">\n                <div class="inline-flex items-center justify-center w-14 h-14 bg-orange-50 text-orange-600 rounded-2xl mb-4">\n                    <i data-lucide="zap" class="w-7 h-7 fill-orange-600"></i>\n                </div>\n                <h3 class="text-2xl font-black text-slate-900 mb-2">ЗАПИСЬ НА ПРОБНОЕ</h3>\n                <p class="text-slate-500 text-sm">Сначала напишем в Telegram, позвоним только если не ответите. На пробное нужны только форма и кроссовки, остальное выдадим.</p>\n            </div>\n            <form class="space-y-4" onsubmit="submitForm(event)">\n                <div class="grid grid-cols-2 gap-3 mb-2">\n                    <label class="cursor-pointer">\n                        <input type="radio" name="type" value="Ребенок" class="hidden radio-card" checked>\n                        <div class="border border-slate-200 rounded-xl py-3 text-center text-sm font-bold text-slate-500 transition-all hover:border-orange-300 peer-checked:border-orange-500 peer-checked:text-orange-600 peer-checked:bg-orange-50">Ребенок</div>\n                    </label>\n                    <label class="cursor-pointer">\n                        <input type="radio" name="type" value="Взрослый" class="hidden radio-card">\n                        <div class="border border-slate-200 rounded-xl py-3 text-center text-sm font-bold text-slate-500 transition-all hover:border-orange-300 peer-checked:border-orange-500 peer-checked:text-orange-600 peer-checked:bg-orange-50">Взрослый</div>\n                    </label>\n                </div>\n                <div>\n                    <label class="block text-xs font-bold uppercase tracking-widest text-slate-500 mb-2">Ваше имя</label>\n                    <input type="text" name="name" placeholder="Иван" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-900 focus:outline-none focus:border-orange-500 focus:ring-4 focus:ring-orange-500/10 transition-all" required>\n                </div>\n                <div>\n                    <label class="block text-xs font-bold uppercase tracking-widest text-slate-500 mb-2">Телефон</label>\n                    <input type="tel" name="phone" placeholder="+7 (999) 000-00-00" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-900 focus:outline-none focus:border-orange-500 focus:ring-4 focus:ring-orange-500/10 transition-all" required>\n                </div>\n                <button type="submit" id="submit-btn" class="w-full bg-orange-600 text-white font-black uppercase tracking-widest text-sm py-4 rounded-xl shadow-xl shadow-orange-200 hover:bg-orange-700 hover:scale-[1.02] transition-all flex items-center justify-center">\n                    <span>Записаться бесплатно</span>\n                    <svg id="loading-spinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n                    </svg>\n                </button>\n                <p class="text-center text-[10px] text-slate-400 mt-4 leading-tight">Нажимая кнопку, вы соглашаетесь с <a href="#" class="underline hover:text-orange-600">политикой конфиденциальности</a>.</p>\n            </form>\n        </div>\n    </div>\n</div>\n`; function initModal() { if (!document.querySelector('link[href*="modal.css"]')) { const e = document.createElement("link"); e.rel = "stylesheet", e.href = "css/modal.css", document.head.appendChild(e) } if (!document.getElementById("modal-custom-style")) { const e = document.createElement("style"); e.id = "modal-custom-style", e.innerHTML = "\n            .radio-card:checked + div {\n                border-color: #f97316;\n                color: #ea580c;\n                background-color: #fff7ed;\n            }\n        ", document.head.appendChild(e) } if (!document.getElementById("modal-overlay")) { const e = document.createElement("div"); e.innerHTML = MODAL_HTML, document.body.appendChild(e.firstElementChild) } const e = document.getElementById("modal-overlay"); e && e.addEventListener("click", e => { e.target === e.currentTarget && closeModal() }), "undefined" != typeof lucide && lucide.createIcons() } function openModal() { const e = document.getElementById("modal-overlay"), t = document.getElementById("modal-content"), n = document.getElementById("modal-success"), o = document.getElementById("modal-form-container"); if (!e || !t) return console.warn("Modal elements not found, initializing..."), initModal(), void setTimeout(openModal, 50); n && n.classList.add("hidden"), o && o.classList.remove("hidden"), e.classList.remove("hidden"), void e.offsetWidth, setTimeout(() => { e.classList.remove("opacity-0"), t.classList.remove("scale-95"), t.classList.add("scale-100") }, 10); const l = document.getElementById("mobile-menu"); l && !l.classList.contains("hidden") && ("function" == typeof toggleMobileMenu ? toggleMobileMenu() : (l.classList.add("hidden"), l.classList.remove("flex"))) } function closeModal() { const e = document.getElementById("modal-overlay"), t = document.getElementById("modal-content"); e && t && (e.classList.add("opacity-0"), t.classList.remove("scale-100"), t.classList.add("scale-95"), setTimeout(() => { e.classList.add("hidden") }, 300), "#contacts" === window.location.hash && history.pushState("", document.title, window.location.pathname + window.location.search)) } async function getAnalyticsData() { const e = { url: window.location.href, referrer: document.referrer, userAgent: navigator.userAgent, screen: `${window.screen.width}x${window.screen.height}`, timezone: Intl.DateTimeFormat().resolvedOptions().timeZone, language: navigator.language }, t = new URLSearchParams(window.location.search);["utm_source", "utm_medium", "utm_campaign", "utm_term", "utm_content"].forEach(n => { t.has(n) && (e[n] = t.get(n)) }); try { const t = fetch("https://api.ipify.org?format=json").then(e => e.json()), n = new Promise((e, t) => setTimeout(() => t(new Error("Timeout")), 1500)), o = await Promise.race([t, n]); o && o.ip && (e.ip = o.ip) } catch (e) { console.warn("IP fetch skipped (timeout or error)") } return e } async function submitForm(e) { if (e.preventDefault(), "YOUR_WEB_APP_URL_HERE" === GOOGLE_SCRIPT_URL) return void alert("Ошибка настройки: Не указана ссылка на скрипт обработчика."); const t = e.target, n = document.getElementById("submit-btn"), o = document.getElementById("loading-spinner"), l = document.getElementById("modal-success"), a = document.getElementById("modal-form-container"); n.disabled = !0, n.classList.add("opacity-75", "cursor-not-allowed"), o && o.classList.remove("hidden"); const r = new FormData(t), s = {}; r.forEach((e, t) => s[t] = e); try { const e = await getAnalyticsData(); Object.assign(s, { utm_source: e.utm_source || "", utm_medium: e.utm_medium || "", utm_campaign: e.utm_campaign || "", utm_term: e.utm_term || "", utm_content: e.utm_content || "", referrer: e.referrer || "", page_url: e.url || "", user_agent: e.userAgent || "", ip_address: e.ip || "", screen_res: e.screen || "", timezone: e.timezone || "" }) } catch (e) { console.warn("Analytics collection failed", e) } const c = new URLSearchParams(s); fetch(GOOGLE_SCRIPT_URL, { method: "POST", body: c }).then(e => e.json().catch(() => ({ result: "success" }))).then(e => { l && l.classList.remove("hidden"), a && a.classList.add("hidden"), setTimeout(() => { closeModal(), setTimeout(() => { l.classList.add("hidden"), a.classList.remove("hidden"), t.reset(), n.disabled = !1, n.classList.remove("opacity-75", "cursor-not-allowed"), o && o.classList.add("hidden") }, 300) }, 3e3) }).catch(e => { console.error("Error:", e), alert("Произошла ошибка при отправке. Пожалуйста, позвоните нам."), n.disabled = !1, n.classList.remove("opacity-75", "cursor-not-allowed"), o && o.classList.add("hidden") }) } document.addEventListener("DOMContentLoaded", () => { initModal(), "#contacts" === window.location.hash && setTimeout(openModal, 500) }), window.openModal = openModal, window.closeModal = closeModal, window.submitForm = submitForm;
